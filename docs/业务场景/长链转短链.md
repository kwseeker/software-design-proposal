# 百亿短 URL 生成器怎么设计

看到这么一个场景题目，之前在移动的一个项目中有碰到类似的功能，是实现的短号设计。应用中使用短号后台请求业务服务会通过短号和长号的映射获取对应的长号，实际还是使用长号发出请求，但是当时看不到长号生成短号的算法，一直没有总结过相关方案。

短URL、短号比较方便分享，比如在海报、图片或者名片中分享时。

这个问题涉及几个要点：

+ **长URL怎么生成短URL且不重复**

  比如有这么个长URL `https://www.bilibili.com/video/BV16i1LYYEAd/?spm_id_from=333.1007.tianma.1-1-1.click&vd_source=e085f6b3e74d1e9c35fe18734cac42f7`。

+ **怎么通过短URL获取对应的长URL**

  因为最终后台处理还是需要借助长URL实现。

+ **百亿级别的短URL和长URL映射关系怎么存储**

+ **如何支持高并发生成短URL和查询短URL对应的长URL**

容易想到的方案：

+ **无损压缩算法**

  缺点是压缩率不容易做的很高，可能很难满足短URL长度要求；

  计算资源消耗大，不过可以通过缓存缓解。

+ **数据库映射**

  这其实是使用最多且最可行的一种实现方案，比如使用 MySQL 存储长 URL ，**对雪花自增主键经 Base62 编码后的结果作为短URL**，短URL也存储到MySQL行。

  >  之所以不直接用主键作为短URL是为了避免暴露主键值。

  为支持高并发查询可以将短URL为键长URL为值存储到Redis，如果只有部分热数据可以设置 Redis LRU 驱逐策略。

  另外需要避免为长URL重复生成短 URL，需要查询某个长URL是否已经生成过短 URL，长URL由于是长字符串并不适合作为索引，可以对长URL求Hash作为索引字段值添加到数据行，Hash值冲突率不会很高，通过此索引字段可能查处多个长URL，再一一比对即可。

其他方案：

+ **基数转换**

  仅适用于全是数字的长URL，可以将数字转换为更高的进制数，比如借助 10个数字 + 26 × 2 个大小写英文字母，可以实现62进制数的表示，可以将10进制数转换成62进制数。

  > Base62 也属于是一种基数转换。



 